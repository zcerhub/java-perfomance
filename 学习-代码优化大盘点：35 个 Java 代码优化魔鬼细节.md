## 代码优化方法

代码优化目标：

- 减小代码的体积
- 提高代码的执行效率
- 代码优化细节

#### ~~1.尽量指定类、方法的final修饰符~~

尽量使用final修饰类、方法、变量。如果一个类被final修饰，则其所有的方法都是final，此时编译器会将被final修饰的方式优化为内联方法。这项措施可以使得性能平均提示50%。

评论：该项优化措施可能在老版本的jvm有效果，在早期的jvm当发现一个方法被声明为final则会将其优化为内联的方式。但是对于hotspot虚拟机来说可以通过逃逸分析来决定对其是否进行内联，不管该方法有没有声明final。所以对于final提升性能在hotspot是说不通的。详细可参考文献《final关键字对性能提升研究》

#### 2.尽量重用对象

创建对象是一个很耗时的操作：涉及到内存的分配和对象的初始化，而且在对象使用完毕后还需要GC的回收。所以尽量避免对象的创建，尽可能的使用单例、String的拼接操作时使用StringBuffer或者StringBuilder。

#### 3.尽可能使用局部变量

局部变量的生命周期更短，在方法结束时其引用的对象会被GC回收。hotspot可以利用JIT的逃逸分析将没有发生逃逸的对象在栈上分配，随着栈帧的销毁而回收，不需要GC的参与。

#### 4.即使关闭流

java的编程中对IO和数据库的操作时在用完后需要即使关闭流，因为这些流会占用系统资源，忘记关闭会造成严重的后果。如果是在java7以上建议使用try-with-resources操作流。

#### 5.尽量减少对变量的重复计算

对方法的调用时会牵扯到栈帧的创建，入栈，出栈等操作。可以使用变量来代替对方法的调用。

示例：

```
        List<Integer> nums = new ArrayList<>();
        for (int i = 0; i < nums.size(); i++) {
            System.out.println(nums.get(i));
        }
```

上面的这种写法可以替换为：

```
        int size = nums.size();
        for (int i = 0; i < size; i++) {
            System.out.println(nums.get(i));
        }
```

将nums的长度保存在size中，每次遍历时避免了nums.size()方法的调用。和方法的内联有异曲同工之妙。

#### 6.尽量使用懒加载的方式，在需要的时候才创建

比如：

```
        Integer num=1;
        if (size == 1) {
            nums.add(num);
        }
```

可以将其替换为：

```
        if (size == 1) {
            Integer num=1;
            nums.add(num);
        }
```

在spring中可以配置bean为懒加载减少内存的占用。可以从上面的例子看出，懒加载和方法3在某些情况下是等价的。尽可能的缩小变量的作用域，也就是在变量用到的时候才创建，即懒加载。其优势的应用启动时比较快，内存的使用率较高，其缺点时如果对于一个比较重的对象：比如线程池，连接池。其创建过程比较耗时，要是在用到时才创建可能会用影响用户的体验，对于这些对象还是在应用启动时就创建。

#### 7.慎用异常















### 参考文献

- [代码优化大盘点：35 个 Java 代码优化魔鬼细节](https://cloud.tencent.com/developer/article/1758220)
- final关键字对性能提升研究

- 